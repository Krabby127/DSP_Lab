% !TEX TS-program = pdflatex
% !TEX encoding = UTF-8 Unicode

% This is a simple template for a LaTeX document using the "article" class.
% See "book", "report", "letter" for other types of document.

\documentclass{article} % use larger type; default would be 10pt

\usepackage[utf8]{inputenc} % set input encoding (not needed with XeLaTeX)

%%% Examples of Article customizations
% These packages are optional, depending whether you want the features they provide.
% See the LaTeX Companion or other references for full information.

%%% PAGE DIMENSIONS
\usepackage{geometry} % to change the page dimensions
\geometry{a4paper} % or letterpaper (US) or a5paper or....
% \geometry{margin=2in} % for example, change the margins to 2 inches all round
% \geometry{landscape} % set up the page for landscape
%   read geometry.pdf for detailed page layout information

\usepackage{graphicx} % support the \includegraphics command and options
\usepackage[normalem]{ulem}
% \usepackage[parfill]{parskip} % Activate to begin paragraphs with an empty line rather than an indent

%%% PACKAGES
\usepackage{booktabs} % for much better looking tables
\usepackage{array} % for better arrays (eg matrices) in maths
\usepackage{paralist} % very flexible & customisable lists (eg. enumerate/itemize, etc.)
\usepackage{verbatim} % adds environment for commenting out blocks of text & for better verbatim
\usepackage{subfig} % make it possible to include more than one captioned figure/table in a single float
% These packages are all incorporated in the memoir class to one degree or another...
\usepackage{mcode}
%%% HEADERS & FOOTERS
\usepackage{fancyhdr} % This should be set AFTER setting up the page geometry
\pagestyle{fancy} % options: empty , plain , fancy
\renewcommand{\headrulewidth}{0pt} % customise the layout...
\lhead{}\chead{}\rhead{}
\lfoot{}\cfoot{\thepage}\rfoot{}

%%% SECTION TITLE APPEARANCE
\usepackage{sectsty}
\allsectionsfont{\sffamily\mdseries\upshape} % (See the fntguide.pdf for font help)
% (This matches ConTeXt defaults)

%%% ToC (table of contents) APPEARANCE
\usepackage[nottoc,notlof,notlot]{tocbibind} % Put the bibliography in the ToC
\usepackage[titles,subfigure]{tocloft} % Alter the style of the Table of Contents
\renewcommand{\cftsecfont}{\rmfamily\mdseries\upshape}
\renewcommand{\cftsecpagefont}{\rmfamily\mdseries\upshape} % No bold!
\renewcommand{\topfraction}{0.85}
\renewcommand{\textfraction}{0.1}
\renewcommand{\floatpagefraction}{0.85}
%%% END Article customizations
\usepackage{framed}
\usepackage{amsfonts}
\usepackage{amsmath}
%%% The "real" document content comes below...
\newcommand{\includecode}[2][c]{\lstinputlisting[caption=#2, escapechar=, style=custom#1]{#2}<!---->}
\title{Lab 1}
\author{Michael Eller}
\date{February 1, 2016} % Activate to display a given date or no date (if empty),
         	      % otherwise the current date is printed 

\begin{document}
\maketitle

\section*{Introduction}
The goal of this lab is to explore different methods of categorizing 
music into specific genres. Several methods of automated music 
analysis exist already, including \textbf{score following}, 
\textbf{automatic music transcription}, 
\textbf{music recommendation}, and \textbf{machine listening}. 
Unfortunately, all of these tools are still rudimentary. 
Faster, more efficient, methods still need to be developed in order
to allow automated music analysis to be implemented on portable music
players. The goal of this lab is to develop tools to automatically
extract some defining features of music that will help us to
categorize them more easily. 
\section{Sampling Rates}
Current high-quality audio standards have a 24-bit depth and is sampled at 96 kHz. This 24-bit depth means there are 16,777,216 possible
values for the audio signal at any given instance. It also means we are able to replicate frequencies up to 48 kHz. While this is far
above the 20 kHz limit of human hearing, DVD audio is simply not high enough quality enough for a dolphin to listen to. 

\begin{framed}
\textbf{Assignment}
\begin{enumerate}
\item Dolphins can only hear sounds over the frequency range [7 - 120] kHz. At what sampling
frequency $f_s$ should we sample digital audio signals for dolphins?
\end{enumerate}
\end{framed}

Nyquist theorem states that in order to accurately recreate a signal with maximum frequency $f_s/2$, we must sample at a minimum frequency of $f_s$. 
Therefore, our sampling frequency for digital audio signals for dolphins should be at minimum 240 kHz. Currently, one of the highest portable audio
standards of BD-ROM LPCM (lossless) allow for 24 bit/sample and a maximum sampling frequency of only 192 kHz. Less common standards do
exist though: Digital eXtreme Definition at 352.8 kHz using for recording and editing Super Audio CDs, SACD at 2,822.4 kHz known as Direct Stream 
Digital, and Double-Rate DSD at 5,644.8 kHz used in some professional DSD recorders. 
Therefore, as it stands, we might want to stay away from producing audio for dolphins (at least until better recording standards are developed. 

\section{Audio signal}

\begin{framed}
\textbf{Assignment}
\begin{enumerate}
\setcounter{enumi}{1}
\item Write a MATLAB function that extract T seconds of music from a given track. You
will use the MATLAB function \sout{waveread} audioread to read a track and the function play to
listen to the track.\\\\
In the lab you will use T =\textbf{24 seconds} from the middle of each track to compare the
different algorithms. Download the files, and test your function.
\end{enumerate}
\end{framed}
\lstinputlisting[caption=extractSound.m,language=MATLAB,numbers=left]{./extractSound.m}
This MATLAB function is fairly straightforward. MATLAB's built-in function \emph{audioinfo} provided all the necessary attributes to allow my function to parse
any .wav file and extract the number of samples needed. 

\section{Low Level Features}
The bulk of music analysis is done in the frequency spectrum, however, 
there are some low level features that can be found from the time-domain
analysis of music as well. 
\subsection{Loudness}
There is not an easy way to describe \emph{loudness}, but 
one way to mathematically quantize it is by finding it
standard deviation, $\sigma(n)$. \\
\begin{equation}\label{eq:loud_std}
\sigma(n)=\sqrt{\frac{1}{N-1} \sum\limits_{m=-N/2}^{N/2-1} 
[ x(n+m)-\mathbb{E}[x_n]]^2 }\hspace{5pt} \text{ with }\hspace{5pt} 
\mathbb{E}[x_n]=\frac{1}{N}\sum\limits_{m=-N/2}^{N/2-1}x(n+m)
\end{equation}

\begin{framed}
\textbf{Assignment}
\begin{enumerate}
\setcounter{enumi}{2}
\item Implement the loudness and ZCR and evaluate these features on the different music
tracks. Your MATLAB function should display each feature as a time series in a separate
figure.
\end{enumerate}
\end{framed}

The following is an excerpt from my \emph{loudness} function. My \emph{extractSound} function extracts 24 seconds around the middle of the song. 
The song excerpt is then split into frames of size 255 overlapped (at least) halfway with the previous frame. 
\lstinputlisting[caption=loudness.m,language=MATLAB,numbers=left,firstline=30,lastline=32,firstnumber=30]{./loudness.m}


\begin{figure}[h]
\centering
\includegraphics[width=\textwidth]{Loudness_track201-classical.png}
\caption{Loudness value per frame}
\label{fig:loudness}
\end{figure}

Figure \ref{fig:loudness} shows an example of the function applied to "track201-classical.wav". The figure would imply that, for the selection  of the song, the beginning is quite loud, 
then quiets down until two loud moments, and finishes at a moderately quiet section. If one listens to the song selection in question, the results of my loudness function can be confirmed.
The other loudness plots can be found in Appendix \ref{sec:LoudnessFigures}

\clearpage
\appendix
\section{Figures}
\subsection{Loudness}
\label{sec:LoudnessFigures}

\setcounter{figure}{0}
\begin{figure}[h!]
\centering
\includegraphics[width=0.75\textwidth]{Loudness_track201-classical.png}
\caption{Loudness value per frame, classical201}
\label{fig:loudness_201}
\end{figure}


\begin{figure}
\centering
\vspace{-400em}
\includegraphics[width=0.75\textwidth]{Loudness_track204-classical.png}
\caption{Loudness value per frame, classical204}
\label{fig:loudness_204}
\end{figure}

\begin{figure}
\centering
\includegraphics[width=0.75\textwidth]{Loudness_track370-electronic.png}
\caption{Loudness value per frame, electronic370}
\label{fig:loudness_370}
\end{figure}

\begin{figure}
\centering
\includegraphics[width=0.75\textwidth]{Loudness_track396-electronic.png}
\caption{Loudness value per frame, electronic396}
\label{fig:loudness_396}
\end{figure}

\begin{figure}
\centering
\includegraphics[width=0.75\textwidth]{Loudness_track437-jazz.png}
\caption{Loudness value per frame, jazz437}
\label{fig:loudness_437}
\end{figure}

\begin{figure}
\centering
\includegraphics[width=0.75\textwidth]{Loudness_track439-jazz.png}
\caption{Loudness value per frame, jazz439}
\label{fig:loudness_439}
\end{figure}

\begin{figure}
\centering
\includegraphics[width=0.75\textwidth]{Loudness_track463-metal.png}
\caption{Loudness value per frame, metal463}
\label{fig:loudness_463}
\end{figure}


\begin{figure}
\centering
\includegraphics[width=0.75\textwidth]{Loudness_track492-metal.png}
\caption{Loudness value per frame, metal492}
\label{fig:loudness_492}
\end{figure}


\begin{figure}
\centering
\includegraphics[width=0.75\textwidth]{Loudness_track547-rock.png}
\caption{Loudness value per frame, rock547}
\label{fig:loudness_547}
\end{figure}


\begin{figure}
\centering
\includegraphics[width=0.75\textwidth]{Loudness_track550-rock.png}
\caption{Loudness value per frame, rock550}
\label{fig:loudness_550}
\end{figure}


\begin{figure}
\centering
\includegraphics[width=0.75\textwidth]{Loudness_track707-world.png}
\caption{Loudness value per frame, world707}
\label{fig:loudness_707}
\end{figure}


\begin{figure}
\centering
\includegraphics[width=0.75\textwidth]{Loudness_track729-world.png}
\caption{Loudness value per frame, world729}
\label{fig:loudness_729}
\end{figure}



%\listoffigures
\end{document}
